version: 1.0.0.{build}-beta

environment:
  TIMEOUT: "5m"
  CGO_ENABLED: 0
  GOPATH: C:\gopath

platform:
  - x86
  - x64

clone_folder: C:\gopath\src\github.com\thriqon\involucro

install:
  - go get -u github.com/jstemmer/go-junit-report
  - go version

build_script:
  - go get ./...
  - go build -ldflags "-s -w" ./.

test_script:
  - go test ./runtime/... -v | %GOPATH%\bin\go-junit-report > unit.xml
  - ps: $wc = New-Object 'System.Net.WebClient'; $wc.UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\unit.xml))

deploy: off

artifacts:
  - path: involucro.exe
    name: Binary

notifications:
  - provider: Webhook
    url: https://webhooks.gitter.im/e/82d4a0a82ee4e606a8b2
    on_build_success: true
    on_build_failure: true
    on_build_status_changed: true
